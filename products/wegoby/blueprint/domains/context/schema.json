{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "title": "ContextSnapshot",
  "description": "Ephemeral session context - what's relevant right now",
  "type": "object",
  "required": ["sessionId", "timestamp", "situation"],
  "properties": {
    "sessionId": {
      "type": "string",
      "description": "Unique session identifier"
    },
    "userId": {
      "type": "string",
      "description": "User identifier"
    },
    "miniappId": {
      "type": "string",
      "description": "Current mini-app",
      "pattern": "^to-[a-z]+$"
    },
    "timestamp": {
      "type": "string",
      "format": "date-time",
      "description": "When this snapshot was created"
    },
    "situation": {
      "$ref": "#/definitions/Situation"
    },
    "constraints": {
      "$ref": "#/definitions/Constraints"
    },
    "mood": {
      "$ref": "#/definitions/Mood"
    },
    "domain": {
      "type": "object",
      "description": "Mini-app specific context data",
      "additionalProperties": true
    },
    "naturalItems": {
      "type": "array",
      "description": "Natural language context statements",
      "items": {
        "type": "string"
      }
    },
    "policyOverrides": {
      "type": "object",
      "description": "Temporary policy overrides derived from session context",
      "properties": {
        "density": { "type": "string", "enum": ["low", "medium", "high"] },
        "structure": { "type": "string", "enum": ["loose", "guided"] },
        "verbosity": { "type": "string", "enum": ["minimal", "normal", "detailed"] },
        "autonomy": { "type": "string", "enum": ["system-led", "shared", "user-led"] },
        "ctaStrength": { "type": "string", "enum": ["soft", "clear", "urgent"] },
        "pace": { "type": "string", "enum": ["fast", "normal", "calm"] },
        "chunking": { "type": "string", "enum": ["small", "medium", "large"] },
        "useHistory": { "type": "boolean" },
        "noveltyBias": { "type": "string", "enum": ["low", "medium", "high"] },
        "tone": { "type": "string", "enum": ["neutral", "warm", "playful"] },
        "confidence": { "type": "string", "enum": ["cautious", "balanced", "assertive"] }
      }
    },
    "buildMethod": {
      "type": "string",
      "enum": ["chat", "automatic", "user-input", "mixed"],
      "description": "How this context was built"
    }
  },
  "definitions": {
    "Situation": {
      "type": "object",
      "description": "Environmental and situational factors",
      "properties": {
        "location": {
          "type": "string",
          "enum": ["home", "restaurant", "commute", "work", "outdoors", "unknown"]
        },
        "timeOfDay": {
          "type": "string",
          "enum": ["morning", "afternoon", "evening", "night"]
        },
        "dayType": {
          "type": "string",
          "enum": ["weekday", "weekend", "holiday"]
        },
        "deviceType": {
          "type": "string",
          "enum": ["mobile", "tablet", "desktop"]
        }
      }
    },
    "Constraints": {
      "type": "object",
      "description": "Limitations and requirements for this session",
      "properties": {
        "time": {
          "type": "string",
          "description": "Time available (e.g., '30min', '1 hour', 'no limit')"
        },
        "budget": {
          "type": "string",
          "enum": ["cheap", "moderate", "splurge", "unspecified"]
        },
        "energy": {
          "type": "string",
          "enum": ["tired", "normal", "energetic"]
        },
        "social": {
          "type": "string",
          "enum": ["alone", "with-partner", "with-family", "group"]
        },
        "custom": {
          "type": "array",
          "items": { "type": "string" },
          "description": "Any other constraints mentioned"
        }
      }
    },
    "Mood": {
      "type": "object",
      "description": "User's current disposition",
      "properties": {
        "adventurousness": {
          "type": "string",
          "enum": ["low", "medium", "high"],
          "default": "medium"
        },
        "decisiveness": {
          "type": "string",
          "enum": ["want-options", "want-recommendation"],
          "default": "want-recommendation"
        },
        "urgency": {
          "type": "string",
          "enum": ["relaxed", "normal", "urgent"],
          "default": "normal"
        }
      }
    }
  }
}
